import pandas as pd
from sklearn.model_selection import train_test_split

# Create time blocks (e.g., hourly)
data['time_block'] = pd.to_datetime(data['timestamp'], unit='s').dt.floor('H')

splits = {'train': [], 'val': [], 'test': []}
for block, group in data.groupby('time_block'):
    # Stratified split within each block
    temp_train, temp_test = train_test_split(group, test_size=0.3, stratify=group['label'])
    temp_val, temp_test = train_test_split(temp_test, test_size=0.5, stratify=temp_test['label'])
    
    splits['train'].append(temp_train)
    splits['val'].append(temp_val)
    splits['test'].append(temp_test)

train = pd.concat(splits['train'])
val = pd.concat(splits['val'])
test = pd.concat(splits['test'])
